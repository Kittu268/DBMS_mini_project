--- START OF FILE: ai_assistant_api.php ---
--------------------------------------------------------
<?php
header('Content-Type: application/json; charset=UTF-8');
ini_set('display_errors', 0);
error_reporting(E_ALL);

include 'db.php';
if (session_status() === PHP_SESSION_NONE) session_start();

function sendJson($reply) {
    echo json_encode(['reply' => $reply]);
    exit;
}

// Catch errors
set_error_handler(function($severity, $message) {
    sendJson("âš ï¸ PHP Error: $message");
});
register_shutdown_function(function() {
    $error = error_get_last();
    if ($error) sendJson("âš ï¸ Fatal Error: {$error['message']}");
});

// Input
$data = json_decode(file_get_contents("php://input"), true);
$prompt = strtolower(trim($data['prompt'] ?? ''));
$email = $_SESSION['email'] ?? '';
if (!$prompt) sendJson("âŒ No prompt provided.");

// -------------------
// Greetings
// -------------------
if (strpos($prompt, 'hello') !== false || strpos($prompt, 'hi') !== false) {
    sendJson("ðŸ‘‹ Hello! How can I assist you with your flights or reservations?");
}

// -------------------
// Reservation Count
// -------------------
if (strpos($prompt, 'my bookings') !== false || strpos($prompt, 'how many reservations') !== false) {
    if (!$email) sendJson("âŒ Please log in to see your reservations.");
    $stmt = $conn->prepare("SELECT COUNT(*) AS total FROM Reservation WHERE Email = ?");
    $stmt->bind_param("s", $email);
    $stmt->execute();
    $row = $stmt->get_result()->fetch_assoc();
    $count = (int)($row['total'] ?? 0);
    sendJson("ðŸ“Š You have $count active reservation(s).");
}

// -------------------
// Reservation List
// -------------------
if (strpos($prompt, 'show my flights') !== false || strpos($prompt, 'my reservation') !== false) {
    if (!$email) sendJson("âŒ Please log in to view your reservations.");
    $stmt = $conn->prepare("SELECT Flight_number, Leg_no, Date, Seat_no FROM Reservation WHERE Email = ?");
    $stmt->bind_param("s", $email);
    $stmt->execute();
    $result = $stmt->get_result();

    if ($result->num_rows === 0) sendJson("ðŸ“­ You currently have no reservations.");

    // Format as HTML table
    $html = "<table class='table table-bordered table-sm'><thead><tr>";
    while ($field = $result->fetch_field()) {
        $html .= "<th>" . htmlspecialchars($field->name) . "</th>";
    }
    $html .= "</tr></thead><tbody>";

    // Reset pointer
    $result->data_seek(0);
    while ($row = $result->fetch_assoc()) {
        $html .= "<tr>";
        foreach ($row as $val) $html .= "<td>" . htmlspecialchars($val) . "</td>";
        $html .= "</tr>";
    }
    $html .= "</tbody></table>";

    sendJson($html);
}

// -------------------
// SQL Query Execution (SELECT only)
// -------------------
if (strpos($prompt, 'sql') !== false || strpos($prompt, 'query') !== false) {
    preg_match('/SELECT .*/i', $prompt, $matches);
    if (!isset($matches[0])) sendJson("âŒ Please provide a valid SELECT query.");

    $query = $matches[0];
    if (!preg_match('/^\s*SELECT/i', $query)) sendJson("âŒ Only SELECT queries are allowed.");

    $result = $conn->query($query);
    if (!$result) sendJson("âŒ SQL Error: " . $conn->error);
    if ($result->num_rows === 0) sendJson("âœ… Query executed successfully, but no rows found.");

    // Format as HTML table
    $html = "<table class='table table-bordered table-striped table-sm'><thead><tr>";
    while ($field = $result->fetch_field()) $html .= "<th>" . htmlspecialchars($field->name) . "</th>";
    $html .= "</tr></thead><tbody>";

    $result->data_seek(0);
    while ($row = $result->fetch_assoc()) {
        $html .= "<tr>";
        foreach ($row as $val) $html .= "<td>" . htmlspecialchars($val) . "</td>";
        $html .= "</tr>";
    }
    $html .= "</tbody></table>";

    sendJson($html);
}

// -------------------
// Fallback
// -------------------
sendJson("ðŸ¤– Sorry, I didn't understand your request. You can ask about reservations, bookings, or SQL queries.");
--------------------------------------------------------
--- END OF FILE: ai_assistant_api.php ---

--- START OF FILE: ai_chat.php ---
--------------------------------------------------------
<?php
session_start();
if (!isset($_SESSION['username']) || !isset($_SESSION['email'])) {
    header("Location: login.php");
    exit();
}
$username = $_SESSION['username'];
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Assistant - Airline Reservation System</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .chat-container {
            max-width: 700px;
            margin: 30px auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 70vh;
        }
        .chat-history {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f8f9fa;
        }
        .chat-input {
            padding: 10px 15px;
            border-top: 1px solid #ddd;
            background-color: #fff;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
        }
        .user-message {
            background-color: #007bff;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        .assistant-message {
            background-color: #e9ecef;
            color: #343a40;
            margin-right: auto;
            text-align: left;
        }
    </style>
</head>
<body>
<div class="chat-container shadow">
    <div class="p-3 bg-primary text-white text-center">
        <h5>ðŸ¤– Airline Assistant</h5>
    </div>

    <!-- Chat history -->
    <div class="chat-history" id="chatHistory">
        <div class="message assistant-message">
            Hello, <?php echo htmlspecialchars($username); ?>! Ask about flights or reservations.
        </div>
    </div>

    <!-- Predefined query dropdown -->
    <div class="p-2 border-bottom bg-light">
        <label for="predefinedQuery"><strong>Run a predefined query:</strong></label>
        <select id="predefinedQuery" class="form-control">
            <option value="">-- Select Query --</option>
            <option value="SELECT * FROM flight;">All Flights</option>
            <option value="SELECT * FROM reservation;">All Reservations</option>
            <option value="SELECT Email, COUNT(*) AS Total_Reservations FROM reservation GROUP BY Email;">Reservation Count per Customer</option>
            <option value="SELECT f.Flight_number, fl.Departure_airport_code, fl.Arrival_airport_code FROM flight f JOIN flight_leg fl ON f.Flight_number = fl.Flight_number;">Flight + Legs</option>
            <option value="SELECT a.Airplane_id, a.Type_name, t.Company FROM airplane a JOIN airplane_type t ON a.Type_name = t.Type_name;">Airplanes with Type & Company</option>
        </select>
        <button class="btn btn-success btn-block mt-2" onclick="runPredefinedQuery()">Run Query</button>
    </div>

    <!-- User input -->
    <div class="chat-input">
        <div class="input-group">
            <input type="text" id="userInput" class="form-control" placeholder="Type your message..." onkeypress="if(event.key==='Enter') sendMessage()">
            <div class="input-group-append">
                <button class="btn btn-primary" type="button" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>
</div>

<script>
const chatHistoryDiv = document.getElementById('chatHistory');
const userInput = document.getElementById('userInput');
const predefinedQuery = document.getElementById('predefinedQuery');

function appendMessage(sender, message, isHTML=false) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message', sender==='user'?'user-message':'assistant-message');
    if (isHTML) messageDiv.innerHTML = message;
    else messageDiv.textContent = message;
    chatHistoryDiv.appendChild(messageDiv);
    chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
}

// Send free-text message
async function sendMessage() {
    const message = userInput.value.trim();
    if (!message) return;
    appendMessage('user', message);
    userInput.value = '';
    appendMessage('assistant', '...');

    try {
        const res = await fetch('ai_assistant_api.php', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            credentials: 'include',
            body: JSON.stringify({prompt: message})
        });
        const data = await res.json();
        chatHistoryDiv.removeChild(chatHistoryDiv.lastChild);
        appendMessage('assistant', data.reply, true);
    } catch(err) {
        chatHistoryDiv.removeChild(chatHistoryDiv.lastChild);
        appendMessage('assistant', `âš ï¸ Error: ${err.message}`);
    }
}

// Run predefined query
function runPredefinedQuery() {
    const query = predefinedQuery.value;
    if (!query) return alert("Please select a query.");
    appendMessage('user', "[Predefined Query] " + query);
    userInput.value = "sql " + query; // format for API
    sendMessage();
}
</script>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: ai_chat.php ---

--- START OF FILE: all_tables.php ---
--------------------------------------------------------
<?php
include 'header.php';
include 'db.php';

// ðŸ”’ Ensure login
if (!isset($_SESSION['user'])) {
    header("Location: login.php");
    exit();
}

// âœ… Get all tables dynamically
$tables = [];
$result = $conn->query("SHOW TABLES");
if ($result) {
    while ($row = $result->fetch_array()) {
        $tables[] = $row[0];
    }
}

// ðŸ’¾ Handle Create
if ($_SERVER["REQUEST_METHOD"] == "POST" && $_POST['action'] === 'create_record') {
    $table = $_POST['table'];
    $fields = $_POST['fields'];
    $columns = implode(",", array_keys($fields));
    $placeholders = implode(",", array_fill(0, count($fields), "?"));
    $values = array_values($fields);
    $types = str_repeat('s', count($values));

    $stmt = $conn->prepare("INSERT INTO `$table` ($columns) VALUES ($placeholders)");
    $stmt->bind_param($types, ...$values);

    $msg = $stmt->execute()
        ? "âœ… Record added to '$table' successfully."
        : "âŒ Error adding record: " . $conn->error;
}

// âœï¸ Handle Update
if ($_SERVER["REQUEST_METHOD"] == "POST" && $_POST['action'] === 'update_record') {
    $table = $_POST['table'];
    $pk = $_POST['primary_key'];
    $pk_value = $_POST['pk_value'];
    $fields = $_POST['fields'];

    $set_clause = implode(", ", array_map(fn($k) => "$k=?", array_keys($fields)));
    $values = array_values($fields);
    $types = str_repeat('s', count($values)) . "s";

    $stmt = $conn->prepare("UPDATE `$table` SET $set_clause WHERE $pk = ?");
    $stmt->bind_param($types, ...array_merge($values, [$pk_value]));

    $msg = $stmt->execute()
        ? "âœ… Record updated successfully in '$table'."
        : "âŒ Error updating record: " . $conn->error;
}

// âŒ Handle Delete
if ($_SERVER["REQUEST_METHOD"] == "POST" && $_POST['action'] === 'delete_record') {
    $table = $_POST['table'];
    $pk = $_POST['primary_key'];
    $pk_value = $_POST['pk_value'];

    $stmt = $conn->prepare("DELETE FROM `$table` WHERE $pk = ?");
    $stmt->bind_param("s", $pk_value);

    $msg = $stmt->execute()
        ? "ðŸ—‘ï¸ Record deleted from '$table'."
        : "âŒ Error deleting record: " . $conn->error;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“Š All Tables | Airline Reservation System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { background: #f4f6f9; }
    .crud-panel { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 25px; }
    .form-control { font-size: 0.9rem; }
    .btn-sm { padding: 3px 8px; font-size: 0.8rem; }
  </style>
</head>

<body>
  <div class="container mt-4">
    <h2 class="text-center text-primary mb-4">ðŸ“Š All Database Tables</h2>

    <!-- CRUD Panel -->
    <div class="crud-panel">
      <form method="GET" class="row g-2 align-items-center">
        <div class="col-md-5">
          <select name="table" class="form-select" required>
            <option value="">ðŸ”½ Select Table</option>
            <?php foreach ($tables as $table): ?>
              <option value="<?= htmlspecialchars($table) ?>" 
                <?= (isset($_GET['table']) && $_GET['table'] === $table) ? 'selected' : '' ?>>
                <?= ucfirst($table) ?>
              </option>
            <?php endforeach; ?>
          </select>
        </div>

        <div class="col-md-4">
          <select name="action" class="form-select" required>
            <option value="">âš¡ Select Action</option>
            <option value="create" <?= ($_GET['action'] ?? '') === 'create' ? 'selected' : '' ?>>âž• Create</option>
            <option value="read" <?= ($_GET['action'] ?? '') === 'read' ? 'selected' : '' ?>>ðŸ“‹ Read</option>
            <option value="update" <?= ($_GET['action'] ?? '') === 'update' ? 'selected' : '' ?>>âœï¸ Update</option>
            <option value="delete" <?= ($_GET['action'] ?? '') === 'delete' ? 'selected' : '' ?>>âŒ Delete</option>
          </select>
        </div>

        <div class="col-md-3">
          <button type="submit" class="btn btn-primary w-100">Go</button>
        </div>
      </form>
    </div>

    <?php if (!empty($msg)): ?>
      <div class="alert alert-info"><?= $msg; ?></div>
    <?php endif; ?>

    <?php
    if (isset($_GET['table']) && in_array($_GET['table'], $tables)) {
        $table_name = $_GET['table'];
        $action = $_GET['action'] ?? 'read';
        echo "<div class='card mb-5 shadow-sm border-0'>";
        echo "<div class='card-header bg-primary text-white fw-bold fs-5'>".ucfirst($table_name)."</div>";
        echo "<div class='card-body table-responsive'>";

        // Read data
        $data = $conn->query("SELECT * FROM `$table_name`");
        if ($data && $data->num_rows > 0) {
            echo "<table class='table table-bordered table-striped align-middle text-center'>";
            echo "<thead class='table-light'><tr>";
            $fields = $data->fetch_fields();
            foreach ($fields as $field) echo "<th>{$field->name}</th>";
            echo "</tr></thead><tbody>";
            $data->data_seek(0);
            while ($row = $data->fetch_assoc()) {
                echo "<tr>";
                foreach ($row as $v) echo "<td>" . ($v === NULL || $v === '' ? 'â€”' : htmlspecialchars($v)) . "</td>";
                echo "</tr>";
            }
            echo "</tbody></table>";
        } else {
            echo "<p class='text-muted'>No data found in this table.</p>";
        }

        // Create
        if ($action === 'create') {
            $columns = $conn->query("DESCRIBE `$table_name`");
            echo "<hr><h5 class='text-success'>âž• Add New Record</h5>";
            echo "<form method='POST' class='mt-3'>";
            echo "<input type='hidden' name='action' value='create_record'>";
            echo "<input type='hidden' name='table' value='$table_name'>";
            while ($col = $columns->fetch_assoc()) {
                $field = htmlspecialchars($col['Field']);
                echo "<div class='mb-2'><input type='text' name='fields[$field]' placeholder='$field' class='form-control'></div>";
            }
            echo "<button type='submit' class='btn btn-success mt-2'>Add Record</button>";
            echo "</form>";
        }

        // Update
        if ($action === 'update') {
            $columns = $conn->query("DESCRIBE `$table_name`");
            $first = $columns->fetch_assoc();
            $pk = $first['Field'];
            echo "<hr><h5 class='text-warning'>âœï¸ Update Record</h5>";
            echo "<form method='POST' class='mt-3'>";
            echo "<input type='hidden' name='action' value='update_record'>";
            echo "<input type='hidden' name='table' value='$table_name'>";
            echo "<input type='hidden' name='primary_key' value='$pk'>";
            echo "<div class='mb-2'><input type='text' name='pk_value' placeholder='Enter $pk to Update' class='form-control'></div>";
            $columns2 = $conn->query("DESCRIBE `$table_name`");
            while ($col = $columns2->fetch_assoc()) {
                $field = htmlspecialchars($col['Field']);
                echo "<div class='mb-2'><input type='text' name='fields[$field]' placeholder='New value for $field' class='form-control'></div>";
            }
            echo "<button type='submit' class='btn btn-warning mt-2'>Update Record</button>";
            echo "</form>";
        }

        // Delete
        if ($action === 'delete') {
            $columns = $conn->query("DESCRIBE `$table_name`");
            $first = $columns->fetch_assoc();
            $pk = $first['Field'];
            echo "<hr><h5 class='text-danger'>âŒ Delete Record</h5>";
            echo "<form method='POST' class='mt-3'>";
            echo "<input type='hidden' name='action' value='delete_record'>";
            echo "<input type='hidden' name='table' value='$table_name'>";
            echo "<input type='hidden' name='primary_key' value='$pk'>";
            echo "<input type='text' name='pk_value' placeholder='Enter $pk to Delete' class='form-control mb-2'>";
            echo "<button type='submit' class='btn btn-danger'>Delete Record</button>";
            echo "</form>";
        }

        echo "</div></div>";
    }
    ?>
  </div>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: all_tables.php ---

--- START OF FILE: cancel_reservation.php ---
--------------------------------------------------------
<?php
include 'header.php';
include 'db.php';

// ðŸ”’ Restrict access if not logged in
if (!isset($_SESSION['user'])) {
    header("Location: login.php");
    exit();
}

// ðŸ§¹ Handle Delete Request
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $flight = $_POST['flight_number'];
    $leg = $_POST['leg_no'];
    $date = $_POST['date'];
    $seat = $_POST['seat_no'];

    // âœ… Use actual column names (not id)
    $stmt = $conn->prepare("
        DELETE FROM reservation
        WHERE Flight_number = ? AND Leg_no = ? AND Date = ? AND Seat_no = ?
    ");
    $stmt->bind_param("siss", $flight, $leg, $date, $seat);

    if ($stmt->execute()) {
        header("Location: cancel_reservation.php?status=success");
        exit();
    } else {
        header("Location: cancel_reservation.php?status=error");
        exit();
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>âŒ Cancel Reservation | Airline System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background: #f4f6f9;
      font-family: 'Segoe UI', sans-serif;
    }
    .container {
      max-width: 600px;
    }
  </style>
</head>

<body class="container mt-5">
  <h2 class="text-center text-danger mb-4">âŒ Cancel a Reservation</h2>

  <?php if (isset($_GET['status']) && $_GET['status'] == 'success'): ?>
    <div class="alert alert-success text-center">âœ… Reservation cancelled successfully!</div>
  <?php elseif (isset($_GET['status']) && $_GET['status'] == 'error'): ?>
    <div class="alert alert-danger text-center">âŒ Cancellation failed. Please check the details and try again.</div>
  <?php endif; ?>

  <form method="POST" action="cancel_reservation.php" class="border p-4 rounded shadow-sm bg-light">

    <!-- ðŸ§­ Dropdown for existing reservations -->
    <div class="mb-3">
      <label class="form-label fw-bold">Select Existing Reservation</label>
      <select class="form-select" id="reservationDropdown" onchange="fillForm(this)">
        <option value="">ðŸ”½ Choose a reservation</option>
        <?php
        $res = $conn->query("SELECT Flight_number, Leg_no, Date, Seat_no, Customer_name FROM reservation");
        while ($row = $res->fetch_assoc()) {
          $val = htmlspecialchars(json_encode($row));
          echo "<option value='$val'>{$row['Customer_name']} - {$row['Flight_number']} (Seat {$row['Seat_no']})</option>";
        }
        ?>
      </select>
    </div>

    <input type="text" name="flight_number" id="flight_number" class="form-control mb-2" placeholder="Flight Number" required>
    <input type="number" name="leg_no" id="leg_no" class="form-control mb-2" placeholder="Leg No" required>
    <input type="date" name="date" id="date" class="form-control mb-2" required>
    <input type="text" name="seat_no" id="seat_no" class="form-control mb-2" placeholder="Seat No" required>

    <button type="submit" class="btn btn-danger w-100">Cancel Reservation</button>
  </form>

  <div class="mt-4 d-flex justify-content-between">
    <a href="index.php" class="btn btn-outline-secondary">ðŸ  Home</a>
    <a href="view_reservations.php" class="btn btn-outline-primary">ðŸ“‹ View Reservations</a>
  </div>

  <script>
    // Autofill form from dropdown selection
    function fillForm(select) {
      if (!select.value) return;
      const data = JSON.parse(select.value);
      document.getElementById('flight_number').value = data.Flight_number;
      document.getElementById('leg_no').value = data.Leg_no;
      document.getElementById('date').value = data.Date;
      document.getElementById('seat_no').value = data.Seat_no;
    }
  </script>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: cancel_reservation.php ---

--- START OF FILE: clear_chat.php ---
--------------------------------------------------------
<?php
session_start();
unset($_SESSION['chat_history']);
echo json_encode(["status" => "cleared"]);
?>
--------------------------------------------------------
--- END OF FILE: clear_chat.php ---

--- START OF FILE: complex_queries.php ---
--------------------------------------------------------
<?php include 'db.php'; include 'header.php'; ?>
<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="style.css">

  <title>Reports - Complex Queries</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
  <h2>ðŸ“ˆ Airline Reports & Analytics</h2>

  <?php
  // 1ï¸âƒ£ JOIN â€” Flight details with Airplane type
  echo "<h4 class='mt-4 text-primary'>1. Flight and Airplane Type Details (JOIN)</h4>";
  $q1 = "SELECT f.Flight_number, a.Airplane_id, t.Type_name, t.Company
         FROM leg_instance li
         JOIN airplane a ON li.Airplane_id = a.Airplane_id
         JOIN airplane_type t ON a.Type_name = t.Type_name
         JOIN flight f ON li.Flight_number = f.Flight_number
         LIMIT 10";
  $r1 = $conn->query($q1);
  if ($r1->num_rows > 0) {
      echo "<table class='table table-bordered table-striped'><tr>";
      while ($field = $r1->fetch_field()) echo "<th>{$field->name}</th>";
      echo "</tr>";
      while ($row = $r1->fetch_assoc()) {
          echo "<tr>";
          foreach ($row as $val) echo "<td>$val</td>";
          echo "</tr>";
      }
      echo "</table>";
  }

  // 2ï¸âƒ£ UNION â€” Flights either from Air India or SpiceJet
  echo "<h4 class='mt-4 text-primary'>2. Flights from Air India or SpiceJet (UNION)</h4>";
  $q2 = "(SELECT Flight_number, Airline FROM flight WHERE Airline='Air India')
         UNION
         (SELECT Flight_number, Airline FROM flight WHERE Airline='SpiceJet')";
  $r2 = $conn->query($q2);
  if ($r2->num_rows > 0) {
      echo "<table class='table table-bordered table-striped'><tr>";
      while ($field = $r2->fetch_field()) echo "<th>{$field->name}</th>";
      echo "</tr>";
      while ($row = $r2->fetch_assoc()) {
          echo "<tr>";
          foreach ($row as $val) echo "<td>$val</td>";
          echo "</tr>";
      }
      echo "</table>";
  }

  // 3ï¸âƒ£ GROUP BY â€” Count reservations per customer
  echo "<h4 class='mt-4 text-primary'>3. Reservations per Customer (GROUP BY)</h4>";
  $q3 = "SELECT Customer_name, COUNT(*) AS total_reservations FROM reservation GROUP BY Customer_name";
  $r3 = $conn->query($q3);
  if ($r3->num_rows > 0) {
      echo "<table class='table table-bordered table-striped'><tr>";
      while ($field = $r3->fetch_field()) echo "<th>{$field->name}</th>";
      echo "</tr>";
      while ($row = $r3->fetch_assoc()) {
          echo "<tr>";
          foreach ($row as $val) echo "<td>$val</td>";
          echo "</tr>";
      }
      echo "</table>";
  }

  // 4ï¸âƒ£ SUBQUERY â€” Flights with more than one leg
  echo "<h4 class='mt-4 text-primary'>4. Flights with Multiple Legs (SUBQUERY)</h4>";
  $q4 = "SELECT Flight_number FROM flight_leg 
         WHERE Flight_number IN (SELECT Flight_number FROM flight_leg GROUP BY Flight_number HAVING COUNT(*) > 1)";
  $r4 = $conn->query($q4);
  if ($r4->num_rows > 0) {
      echo "<table class='table table-bordered table-striped'><tr><th>Flight_number</th></tr>";
      while ($row = $r4->fetch_assoc()) echo "<tr><td>{$row['Flight_number']}</td></tr>";
      echo "</table>";
  }
  ?>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: complex_queries.php ---

--- START OF FILE: config.php ---
--------------------------------------------------------
<?php
// =========================
// DATABASE CONFIG
// =========================
define("DB_SERVER", "localhost");
define("DB_USERNAME", "root");
define("DB_PASSWORD", "");
define("DB_NAME", "airline_reservation");

// =========================
// OLLAMA CONFIG
// =========================
define("OLLAMA_HOST", "http://127.0.0.1:11434");  // default Ollama address
define("OLLAMA_MODEL", "llama3.2:latest");        // the model you pulled
?>
--------------------------------------------------------
--- END OF FILE: config.php ---

--- START OF FILE: db.php ---
--------------------------------------------------------
<?php
$host = 'localhost';
$user = 'root';
$password = '';
$dbname = 'airline';
$conn = new mysqli($host, $user, $password, $dbname);
if ($conn->connect_error) {
    die("Database Connection Failed: " . $conn->connect_error);
}
?>
--------------------------------------------------------
--- END OF FILE: db.php ---

--- START OF FILE: header.php ---
--------------------------------------------------------
<?php
// âœ… Session Handling at the very top
if (session_status() === PHP_SESSION_NONE) session_start();
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>âœˆï¸ Airline System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: linear-gradient(to right, #eef2f3, #8e9eab); font-family: 'Poppins', sans-serif; }
.nav-link:hover { background-color: #0d6efd; color: #fff !important; border-radius: 8px; }
#aiChatBox { display: none; flex-direction: column; position: fixed; bottom: 80px; right: 25px; width: 360px; height: 460px; background: white; border-radius: 12px; border: 1px solid #ccc; box-shadow: 0 5px 15px rgba(0,0,0,0.2); resize: both; overflow: hidden; min-width: 260px; min-height: 300px; max-width: 800px; max-height: 700px; z-index: 9999; }
#aiChatHeader { background: #0d6efd; color: white; padding: 10px 12px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: move; }
#aiChatBody { flex: 1; padding: 10px; overflow-y: auto; background: #f8f9fa; font-size: 14px; }
.ai-msg, .user-msg { margin: 6px 0; padding: 8px 10px; border-radius: 10px; max-width: 90%; word-wrap: break-word; }
.ai-msg { background: #e9ecef; text-align: left; }
.user-msg { background: #cfe2ff; text-align: right; margin-left: auto; }
#aiChatInput { display: flex; border-top: 1px solid #ccc; }
#aiInput { flex: 1; border: none; padding: 8px; outline: none; }
#aiSend { border: none; background: #0d6efd; color: white; padding: 8px 12px; cursor: pointer; }
#aiSend:hover { background: #0b5ed7; }
</style>
</head>
<body>

<!-- âœ… NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
<div class="container-fluid">
<a class="navbar-brand fw-bold text-primary" href="index.php">âœˆï¸ Airline System</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav ms-auto align-items-center">
<?php if (isset($_SESSION['user'])): ?>
<li class="nav-item"><a class="nav-link" href="index.php">ðŸ  Home</a></li>
<li class="nav-item"><a class="nav-link" href="make_reservation.php">âž• Book</a></li>
<li class="nav-item"><a class="nav-link" href="view_reservations.php">ðŸ“‹ View</a></li>
<li class="nav-item"><a class="nav-link" href="cancel_reservation.php">âŒ Cancel</a></li>
<li class="nav-item"><a class="nav-link" href="all_tables.php">ðŸ“Š Tables</a></li>
<li class="nav-item"><a class="nav-link" href="query_executor.php">ðŸ§  SQL</a></li>
<li class="nav-item"><button id="aiBtn" class="btn btn-outline-primary btn-sm ms-2">ðŸ’¬ AI Assistant</button></li>
<li class="nav-item"><span class="nav-link text-success fw-semibold">ðŸ‘¤ <?= htmlspecialchars($_SESSION['user']); ?></span></li>
<li class="nav-item"><a class="nav-link text-danger" href="logout.php">ðŸšª Logout</a></li>
<?php else: ?>
<li class="nav-item"><a class="nav-link" href="login.php">Login</a></li>
<li class="nav-item"><a class="nav-link" href="signup.php">Sign Up</a></li>
<?php endif; ?>
</ul>
</div>
</div>
</nav>

<!-- ðŸ’¬ AI Chat Popup -->
<div id="aiChatBox">
<div id="aiChatHeader">ðŸ¤– Airline Assistant <span id="aiClose" style="cursor:pointer;">âŒ</span></div>
<div id="aiChatBody"><div class="ai-msg">ðŸ‘‹ Hello! I'm your Airline Assistant. Ask about flights or reservations!</div></div>
<div id="aiChatInput">
<input type="text" id="aiInput" placeholder="Type your question...">
<button id="aiSend">Send</button>
</div>
</div>

<script>
// --- DOM Elements
const aiBtn = document.getElementById("aiBtn");
const aiBox = document.getElementById("aiChatBox");
const aiClose = document.getElementById("aiClose");
const aiInput = document.getElementById("aiInput");
const aiSend = document.getElementById("aiSend");
const aiBody = document.getElementById("aiChatBody");
const aiHeader = document.getElementById("aiChatHeader");

// âœ… Show / Hide Chat
aiBtn?.addEventListener("click", () => aiBox.style.display = "flex");
aiClose?.addEventListener("click", () => aiBox.style.display = "none");

// âœ… Send Message
aiSend.addEventListener("click", sendMessage);
aiInput.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });

async function sendMessage() {
  const text = aiInput.value.trim();
  if (!text) return;
  aiBody.innerHTML += `<div class='user-msg'>${text}</div>`;
  aiInput.value = "";
  aiBody.scrollTop = aiBody.scrollHeight;

  try {
    const res = await fetch("ai_assistant_api.php", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({prompt: text})
    });

    // âœ… Safely parse JSON
    let data;
    try { data = await res.json(); } 
    catch(err) { data = {reply: "âš ï¸ Error: Invalid response from server"}; }

    aiBody.innerHTML += `<div class='ai-msg'>${data.reply}</div>`;
  } catch (err) {
    aiBody.innerHTML += `<div class='ai-msg text-danger'>âš ï¸ Error: ${err.message}</div>`;
  }

  aiBody.scrollTop = aiBody.scrollHeight;
}

// âœ… Drag functionality
let isDragging = false, offsetX, offsetY;
aiHeader.addEventListener("mousedown", e => {
  isDragging = true;
  const rect = aiBox.getBoundingClientRect();
  offsetX = e.clientX - rect.left;
  offsetY = e.clientY - rect.top;
});
document.addEventListener("mousemove", e => {
  if (!isDragging) return;
  aiBox.style.left = (e.clientX - offsetX) + "px";
  aiBox.style.top = (e.clientY - offsetY) + "px";
});
document.addEventListener("mouseup", () => isDragging = false);
</script>
--------------------------------------------------------
--- END OF FILE: header.php ---

--- START OF FILE: index.php ---
--------------------------------------------------------
<?php
include 'header.php';
include 'db.php';

// ðŸ”’ Redirect if not logged in
if (!isset($_SESSION['user'])) {
    header("Location: login.php");
    exit();
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>âœˆï¸ Airline Reservation Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to top, #87ceeb, #e0f7fa);
      font-family: "Poppins", sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    .hero-section {
      background: linear-gradient(135deg, #007bff, #00c6ff);
      color: white;
      padding: 80px 0;
      text-align: center;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      margin-bottom: 40px;
      position: relative;
      overflow: hidden;
    }

    .hero-section h1 { font-size: 2.8rem; font-weight: 700; }
    .hero-section p { font-size: 1.2rem; margin-top: 15px; }

    .feature-card {
      border-radius: 15px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    footer {
      margin-top: 60px;
      text-align: center;
      color: #555;
    }

    /* =======================
       Cloud Background
    ====================== */
    .cloud {
      position: fixed;
      top: 10%;
      left: -3000px;
      width: 4000px;
      opacity: 0.5;
      z-index: 0;
      animation: cloudMove 12s linear infinite;
    }

    @keyframes cloudMove {
      0% { transform: translateX(0); }
      100% { transform: translateX(130vw); }
    }

    /* =======================
       Airplane
    ====================== */
    .airplane {
      position: fixed;
      top: 0%;
      left: -2000px;
      width: 4000px;
      z-index: 0;
	opacity: 0.1;
      animation: fly 20s linear infinite;
    }

    @keyframes fly {
      0% { transform: translateX(0) rotate(0deg); }
      50% { transform: translateX(120vw) rotate(15deg); }
      100% { transform: translateX(-10vw) rotate(0deg); }
    }
  </style>
</head>

<body>
  <!-- ðŸŒ¥ Cloud Background -->
  <img src="images/cloud.png" class="cloud" alt="Cloud">

  <!-- âœˆï¸ Airplane -->
  <img src="images/airplane.png" class="airplane" alt="Airplane">

  <div class="container mt-5">
    <!-- ðŸŒŸ Hero Section -->
    <div class="hero-section">
      <h1>Welcome to the Airline Reservation System</h1>
      <p>Hello, <strong><?= htmlspecialchars($_SESSION['user']); ?></strong> ðŸ‘‹</p>
      <p>Manage your bookings, view reservations, and explore flight information â€” all in one place.</p>
    </div>

    <!-- ðŸ§© System Overview -->
    <div class="text-center mb-5">
      <h2 class="fw-bold text-primary mb-3">What You Can Do Here</h2>
      <p class="text-muted">This Airline Reservation System helps passengers easily manage flights and bookings.  
      You can book, view, cancel reservations, and even chat with our AI assistant for instant support.</p>
    </div>

    <!-- ðŸ§­ Main Feature Cards -->
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card feature-card text-center border-primary">
          <div class="card-body">
            <h4>ðŸ›« Book a Flight</h4>
            <p>Reserve your next flight easily with our smart booking system.</p>
            <a href="make_reservation.php" class="btn btn-primary">Book Now</a>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card feature-card text-center border-success">
          <div class="card-body">
            <h4>ðŸ“‹ View Reservations</h4>
            <p>See your upcoming and past reservations with full details.</p>
            <a href="view_reservations.php" class="btn btn-success">View Details</a>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card feature-card text-center border-danger">
          <div class="card-body">
            <h4>âŒ Cancel Booking</h4>
            <p>Need to change your plans? Cancel any booking safely.</p>
            <a href="cancel_reservation.php" class="btn btn-danger">Cancel Now</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸ” Data Section -->
    <div class="row g-4 mt-4">
      <div class="col-md-6">
        <div class="card feature-card border-warning text-center">
          <div class="card-body">
            <h4>ðŸ“Š All Tables</h4>
            <p>Explore your airline database â€” users, flights, and reservations.</p>
            <a href="all_tables.php" class="btn btn-warning">View Tables</a>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card feature-card border-info text-center">
          <div class="card-body">
            <h4>ðŸ§  SQL Query Explorer</h4>
            <p>Run custom SQL queries securely to understand your data better.</p>
            <a href="query_executor.php" class="btn btn-info text-white">Open Explorer</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸ¤– AI Assistant Note -->
    <div class="mt-5 text-center">
      <h3 class="text-primary">ðŸ’¬ AI Assistant</h3>
      <p class="text-muted">Need quick help? Click on the <strong>ðŸ’¬ AI Assistant</strong> button in the top menu to chat with your intelligent airline assistant â€”  
      ask about flight availability, booking details, or SQL tips!</p>
    </div>

    <!-- Footer -->
    <footer class="mt-5 text-muted">
      <hr>
      <p>âœ¨ Airline Reservation System â€” Developed by UVCE Students | PHP + MySQL + Bootstrap + AI</p>
    </footer>
  </div>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: index.php ---

--- START OF FILE: insert_row.php ---
--------------------------------------------------------
<?php
include 'db.php';

if (!isset($_POST['action'])) {
    echo "invalid request";
    exit;
}

// ðŸ§± STEP 1: Fetch column names for modal form
if ($_POST['action'] === 'get_columns') {
    $table = preg_replace('/[^a-zA-Z0-9_]/', '', $_POST['table']);
    $res = $conn->query("SHOW COLUMNS FROM `$table`");
    if ($res->num_rows > 0) {
        echo "<input type='hidden' name='table' value='$table'>";
        echo "<input type='hidden' name='action' value='insert_row'>";
        while ($col = $res->fetch_assoc()) {
            $name = htmlspecialchars($col['Field']);
            echo "
              <div class='mb-3'>
                <label class='form-label'>$name</label>
                <input type='text' class='form-control' name='cols[$name]' placeholder='Enter $name'>
              </div>
            ";
        }
    } else {
        echo "<p>No columns found for this table.</p>";
    }
    exit;
}

// ðŸ§© STEP 2: Insert new row
if ($_POST['action'] === 'insert_row') {
    $table = preg_replace('/[^a-zA-Z0-9_]/', '', $_POST['table']);
    $cols = $_POST['cols'] ?? [];
    if (empty($cols)) {
        echo "No data to insert.";
        exit;
    }

    $columns = array_keys($cols);
    $values = array_values($cols);

    $colList = implode("`,`", $columns);
    $placeholders = rtrim(str_repeat('?,', count($values)), ',');

    $stmt = $conn->prepare("INSERT INTO `$table` (`$colList`) VALUES ($placeholders)");
    $types = str_repeat('s', count($values));
    $stmt->bind_param($types, ...$values);

    if ($stmt->execute()) {
        echo "âœ… Row inserted successfully!";
    } else {
        echo "âŒ Insert failed: " . $conn->error;
    }
    exit;
}
?>
--------------------------------------------------------
--- END OF FILE: insert_row.php ---

--- START OF FILE: login.php ---
--------------------------------------------------------
<?php
session_start();
include 'db.php';

$error = "";

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $email = trim($_POST['email']);
    $password = $_POST['password'];

    $stmt = $conn->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->bind_param("s", $email);
    $stmt->execute();
    $result = $stmt->get_result();

    if ($row = $result->fetch_assoc()) {
        if (password_verify($password, $row['password'])) {
            // âœ… Store only email in session
            $_SESSION['email'] = $row['email'];
            $_SESSION['user'] = $row['username']; // optional, for greeting

            header("Location: index.php");
            exit();
        } else {
            $error = "âŒ Invalid password.";
        }
    } else {
        $error = "âŒ Email not found.";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | Airline System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
  <h2 class="mb-4">âœˆï¸ Airline System Login</h2>

  <?php if (!empty($error)): ?>
    <div class="alert alert-danger"><?= $error ?></div>
  <?php endif; ?>

  <form method="POST" class="border p-4 rounded bg-light shadow-sm">
    <input type="email" name="email" class="form-control mb-2" placeholder="Email" required>
    <input type="password" name="password" class="form-control mb-2" placeholder="Password" required>
    <button type="submit" class="btn btn-primary w-100">Login</button>
  </form>

  <div class="mt-3">
    <a href="signup.php" class="btn btn-link">Sign Up</a>
  </div>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: login.php ---

--- START OF FILE: logout.php ---
--------------------------------------------------------
<?php
session_start();
session_destroy();
header("Location: login.php");
exit();
?>
--------------------------------------------------------
--- END OF FILE: logout.php ---

--- START OF FILE: make_reservation.php ---
--------------------------------------------------------
<?php
session_start();
if (!isset($_SESSION['email'])) {
    header("Location: login.php");
    exit();
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Make a Reservation</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
  <h2 class="mb-4">âœˆï¸ Make a Reservation</h2>

  <form action="reservation.php" method="POST" class="border p-4 rounded bg-light shadow-sm">
    <div class="mb-3">
      <label for="flight_number" class="form-label">Flight Number</label>
      <input type="text" name="flight_number" id="flight_number" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="leg_no" class="form-label">Leg Number</label>
      <input type="number" name="leg_no" id="leg_no" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="date" class="form-label">Date</label>
      <input type="date" name="date" id="date" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="airplane_id" class="form-label">Airplane ID</label>
      <input type="text" name="airplane_id" id="airplane_id" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="seat_no" class="form-label">Seat Number</label>
      <input type="text" name="seat_no" id="seat_no" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="cphone" class="form-label">Contact Phone</label>
      <input type="text" name="cphone" id="cphone" class="form-control" required>
    </div>

    <button type="submit" class="btn btn-success w-100">Reserve</button>
  </form>

  <div class="mt-3">
    <a href="view_reservation.php" class="btn btn-secondary">Back to Reservations</a>
  </div>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: make_reservation.php ---

--- START OF FILE: query_executor.php ---
--------------------------------------------------------
<?php
include 'db.php';
session_start();
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸ§  SQL Query Explorer</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("queryForm");
    const manualInput = document.getElementById("manual_query");
    manualInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            form.submit();
        }
    });
});
</script>
</head>
<body>
<?php include 'header.php'; ?>

<div class="container mt-5">
<h2>ðŸ§® SQL Query Explorer</h2>
<p class="text-muted">Explore your airline database using predefined queries, manual SELECT, or aggregate functions.</p>

<form method="POST" id="queryForm" class="mb-4">
    <label class="form-label fw-semibold">Choose a predefined query:</label>
    <select name="query_choice" class="form-select mb-3">
        <option value="">-- Select Query --</option>

        <option value="show_tables">ðŸ—‚ï¸ Show All Tables</option>

        <optgroup label="Aggregates">
            <option value="agg1">ðŸ“Š Count Reservations per Flight</option>
            <option value="agg2">ðŸ“Š Total Seats per Airplane Type</option>
            <option value="agg3">ðŸ“Š Average Seats per Flight</option>
            <option value="agg4">ðŸ“Š Max & Min Seats in Airplanes</option>
        </optgroup>

        <optgroup label="Complex Joins">
            <option value="j1">Reservation + Flight</option>
            <option value="j2">Flight + Airplane + Airplane Type</option>
            <option value="j3">Reservation + Leg Instance</option>
            <option value="j4">Reservation + Flight + Leg Instance</option>
            <option value="j5">Reservation + Flight + Airport</option>
            <option value="j6">Flight + Leg Instance + Airport</option>
        </optgroup>
    </select>

    <label for="manual_query" class="form-label fw-semibold mt-3">Or enter your own SQL query (SELECT only):</label>
    <textarea name="manual_query" id="manual_query" class="form-control mb-3" rows="4" placeholder="SELECT * FROM reservation;"></textarea>

    <button type="submit" class="btn btn-success">Run Query</button>
</form>

<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $manual_query = trim($_POST['manual_query'] ?? '');
    $choice = $_POST['query_choice'] ?? '';
    $query = '';

    // Predefined queries
    $queries = [
        // Complex joins
        'j1' => "SELECT r.Email, r.Flight_number, f.Airline
                 FROM reservation r
                 JOIN flight f ON r.Flight_number = f.Flight_number;",
        'j2' => "SELECT f.Flight_number, f.Airline, a.Airplane_id, a.Type_name, t.Company, t.Max_seats
                 FROM flight f
                 JOIN airplane a ON a.Airplane_id = a.Airplane_id -- adjust if needed
                 JOIN airplane_type t ON a.Type_name = t.Type_name;",
        'j3' => "SELECT r.Email, r.Flight_number, li.Date, li.Airplane_id
                 FROM reservation r
                 JOIN leg_instance li ON r.Flight_number = li.Flight_number AND r.Leg_no = li.Leg_no AND r.Date = li.Date;",
        'j4' => "SELECT r.Email, r.Flight_number, f.Airline, li.Date, li.Airplane_id
                 FROM reservation r
                 JOIN flight f ON r.Flight_number = f.Flight_number
                 JOIN leg_instance li ON r.Flight_number = li.Flight_number AND r.Leg_no = li.Leg_no AND r.Date = li.Date;",
        'j5' => "SELECT r.Email, r.Flight_number, dep.Name AS Departure, arr.Name AS Arrival, li.Date
                 FROM reservation r
                 JOIN leg_instance li ON r.Flight_number = li.Flight_number AND r.Leg_no = li.Leg_no AND r.Date = li.Date
                 JOIN flight_leg fl ON li.Flight_number = fl.Flight_number AND li.Leg_no = fl.Leg_no
                 JOIN airport dep ON fl.Departure_airport_code = dep.Airport_code
                 JOIN airport arr ON fl.Arrival_airport_code = arr.Airport_code;",
        'j6' => "SELECT f.Flight_number, f.Airline, li.Airplane_id, dep.Name AS Departure, arr.Name AS Arrival, li.Departure_time, li.Arrival_time
                 FROM flight f
                 JOIN leg_instance li ON f.Flight_number = li.Flight_number
                 JOIN flight_leg fl ON f.Flight_number = fl.Flight_number AND li.Leg_no = fl.Leg_no
                 JOIN airport dep ON fl.Departure_airport_code = dep.Airport_code
                 JOIN airport arr ON fl.Arrival_airport_code = arr.Airport_code;",

        // Aggregate queries
        'agg1' => "SELECT Flight_number, COUNT(*) AS Total_Reservations
                   FROM reservation
                   GROUP BY Flight_number
                   ORDER BY Total_Reservations DESC;",
        'agg2' => "SELECT t.Type_name, t.Company, SUM(a.Total_no_of_seats) AS Total_Seats
                   FROM airplane a
                   JOIN airplane_type t ON a.Type_name = t.Type_name
                   GROUP BY t.Type_name, t.Company;",
        'agg3' => "SELECT f.Flight_number, AVG(li.Number_of_available_seats) AS Avg_Seats
                   FROM flight f
                   JOIN leg_instance li ON f.Flight_number = li.Flight_number
                   GROUP BY f.Flight_number;",
        'agg4' => "SELECT Type_name, MAX(Total_no_of_seats) AS Max_Seats, MIN(Total_no_of_seats) AS Min_Seats
                   FROM airplane
                   GROUP BY Type_name;"
    ];

    // Determine the query
    if ($choice == 'show_tables') {
        $query = "SHOW TABLES;";
    } elseif ($manual_query && preg_match('/^\s*SELECT\b/i', $manual_query)) {
        $query = $manual_query;
    } elseif ($choice && isset($queries[$choice])) {
        $query = $queries[$choice];
    }

    // Execute and display results
    if ($query) {
        echo "<h4 class='text-primary mt-4'>ðŸ§¾ Query Result</h4>";
        $result = $conn->query($query);

        if ($result) {
            if ($result->num_rows > 0) {
                echo "<div class='table-responsive mt-3'><table class='table table-bordered table-striped table-sm'>";
                echo "<thead class='table-light'><tr>";
                while ($field = $result->fetch_field()) {
                    echo "<th>" . htmlspecialchars($field->name ?? '') . "</th>";
                }
                echo "</tr></thead><tbody>";
                while ($row = $result->fetch_assoc()) {
                    echo "<tr>";
                    foreach ($row as $val) {
                        echo "<td>" . htmlspecialchars($val ?? '') . "</td>";
                    }
                    echo "</tr>";
                }
                echo "</tbody></table></div>";
            } else {
                echo "<div class='alert alert-info mt-3'>âœ… Query executed successfully, no rows found.</div>";
            }
        } else {
            echo "<div class='alert alert-danger mt-3'>âŒ SQL Error: " . htmlspecialchars($conn->error) . "<br><code>$query</code></div>";
        }
    } else {
        echo "<div class='alert alert-warning mt-3'>âš ï¸ Please select a valid query or enter a valid SQL query.</div>";
    }
}
?>
</div>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: query_executor.php ---

--- START OF FILE: reservation.php ---
--------------------------------------------------------
<?php
session_start();
include 'db.php';

// âœ… Ensure user is logged in
if (!isset($_SESSION['email'])) {
    echo "<div class='container mt-5'><div class='alert alert-danger'>âŒ You must be logged in to make a reservation.</div></div>";
    exit;
}

// âœ… Only handle POST requests
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    echo "<div class='container mt-5'><div class='alert alert-warning'>âš ï¸ Please access this page via the reservation form.</div></div>";
    exit;
}

// âœ… Collect and validate form data
$flight_number   = trim($_POST['flight_number'] ?? '');
$leg_no          = intval($_POST['leg_no'] ?? 0);
$date            = $_POST['date'] ?? '';
$airplane_id     = trim($_POST['airplane_id'] ?? '');
$seat_no         = trim($_POST['seat_no'] ?? '');
$cphone          = trim($_POST['cphone'] ?? '');
$customer_name   = $_SESSION['user'] ?? 'Unknown';
$customer_email  = $_SESSION['email'];

if (!$flight_number || !$leg_no || !$date || !$airplane_id || !$seat_no || !$cphone) {
    echo "<div class='container mt-5'><div class='alert alert-warning'>âš ï¸ Please fill in all required fields.</div></div>";
    exit;
}

// âœ… Insert reservation
$stmt = $conn->prepare("INSERT INTO Reservation (Flight_number, Leg_no, Date, Airplane_id, Seat_no, Customer_name, Cphone, Email)
                        VALUES (?, ?, ?, ?, ?, ?, ?, ?)");
$stmt->bind_param("sissssss", $flight_number, $leg_no, $date, $airplane_id, $seat_no, $customer_name, $cphone, $customer_email);

echo "<div class='container mt-5'>";
if ($stmt->execute()) {
    echo "<div class='alert alert-success'>âœ… Reservation successful for flight <strong>$flight_number</strong> on <strong>$date</strong>!</div>";
    echo "<a href='view_reservation.php' class='btn btn-primary'>View My Reservations</a>";
} else {
    echo "<div class='alert alert-danger'>âŒ Reservation failed: " . htmlspecialchars($conn->error) . "</div>";
    echo "<a href='make_reservation.php' class='btn btn-secondary'>Try Again</a>";
}
echo "</div>";

$stmt->close();
?>
--------------------------------------------------------
--- END OF FILE: reservation.php ---

--- START OF FILE: reserve.php ---
--------------------------------------------------------
<?php include 'header.php'; ?>

<?php
include 'db.php';

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $flight = $_POST['flight_number'];
    $leg = (int)$_POST['leg_no'];
    $date = $_POST['date'];
    $airplane = $_POST['airplane_id'];
    $seat = $_POST['seat_no'];
    $name = $_POST['customer_name'];
    $phone = $_POST['cphone'];

    // Insert dependencies
    $conn->query("INSERT IGNORE INTO Airport (Airport_code, Name, City, State)
                  VALUES ('BLR', 'Kempegowda Intl', 'Bangalore', 'Karnataka'),
                         ('DEL', 'Indira Gandhi Intl', 'Delhi', 'Delhi')");

    $conn->query("INSERT IGNORE INTO Flight (Flight_number) VALUES ('$flight')");

    $conn->query("INSERT IGNORE INTO Flight_Leg (Flight_number, Leg_no, Departure_airport_code, Arrival_airport_code)
                  VALUES ('$flight', $leg, 'BLR', 'DEL')");

    $conn->query("INSERT IGNORE INTO Airplane_Type (Type_name, Max_seats, Company)
                  VALUES ('Airbus-A320', 180, 'Airbus')");

    $conn->query("INSERT IGNORE INTO Airplane (Airplane_id, Total_no_of_seats, Type_name)
                  VALUES ('$airplane', 180, 'Airbus-A320')");

    $conn->query("INSERT IGNORE INTO Seat (Airplane_id, Seat_no) VALUES ('$airplane', '$seat')");

    // Insert Leg_Instance if missing
    $check = $conn->prepare("SELECT 1 FROM Leg_Instance WHERE Flight_number=? AND Leg_no=? AND Date=?");
    $check->bind_param("sis", $flight, $leg, $date);
    $check->execute();
    $result = $check->get_result();

    if ($result->num_rows === 0) {
        $insert_leg = $conn->prepare("INSERT INTO Leg_Instance (
            Flight_number, Leg_no, Date,
            Number_of_available_seats, Airplane_id,
            Departure_airport_code, Departure_time,
            Arrival_airport_code, Arrival_time
        ) VALUES (?, ?, ?, 100, ?, 'BLR', '10:00:00', 'DEL', '12:30:00')");
        $insert_leg->bind_param("siss", $flight, $leg, $date, $airplane);
        $insert_leg->execute();
    }

    // Insert Reservation
    $stmt = $conn->prepare("INSERT INTO Reservation (
        Flight_number, Leg_no, Date,
        Airplane_id, Seat_no,
        Customer_name, Cphone
    ) VALUES (?, ?, ?, ?, ?, ?, ?)");
    $stmt->bind_param("sisssss", $flight, $leg, $date, $airplane, $seat, $name, $phone);

    if ($stmt->execute()) {
        header("Location: reservation.php?status=success");
        exit();
    } else {
        header("Location: reservation.php?status=error");
        exit();
    }
}
?>
--------------------------------------------------------
--- END OF FILE: reserve.php ---

--- START OF FILE: sample.sql ---
--------------------------------------------------------
CREATE TABLE students (
    student_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    age INT,
    grade VARCHAR(5),
    email VARCHAR(100)
);
INSERT INTO students (first_name, last_name, age, grade, email)
VALUES ('Rahul', 'Mehra', 18, '12A', 'rahul.mehra@example.com');
INSERT INTO students (first_name, last_name, age, grade, email)
VALUES
('Ananya', 'Verma', 17, '11B', 'ananya.verma@example.com'),
('Rohit', 'Patil', 18, '12C', 'rohit.patil@example.com'),
('Sneha', 'Kumar', 17, '11A', 'sneha.kumar@example.com');
SELECT * FROM students;
--------------------------------------------------------
--- END OF FILE: sample.sql ---

--- START OF FILE: sample.txt ---
--------------------------------------------------------
CREATE TABLE students (
    student_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    age INT,
    grade VARCHAR(5),
    email VARCHAR(100)
);
INSERT INTO students (first_name, last_name, age, grade, email)
VALUES ('Rahul', 'Mehra', 18, '12A', 'rahul.mehra@example.com');
INSERT INTO students (first_name, last_name, age, grade, email)
VALUES
('Ananya', 'Verma', 17, '11B', 'ananya.verma@example.com'),
('Rohit', 'Patil', 18, '12C', 'rohit.patil@example.com'),
('Sneha', 'Kumar', 17, '11A', 'sneha.kumar@example.com');
SELECT * FROM students;
--------------------------------------------------------
--- END OF FILE: sample.txt ---

--- START OF FILE: signup.php ---
--------------------------------------------------------
<?php
include 'db.php';
session_start();

$msg = "";
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $username = trim($_POST['username']);
    $email = trim($_POST['email']);
    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);

    $stmt = $conn->prepare("INSERT INTO users (username, email, password) VALUES (?, ?, ?)");
    $stmt->bind_param("sss", $username, $email, $password);

    if ($stmt->execute()) {
        $msg = "<div class='alert alert-success'>âœ… Registration successful! You can now <a href='login.php'>login</a>.</div>";
    } else {
        $msg = "<div class='alert alert-danger'>âŒ Error: " . htmlspecialchars($conn->error) . "</div>";
    }
    $stmt->close();
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Signup | Airline System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
  <?php include 'header.php'; ?>
  <div class="col-md-6 offset-md-3 mt-4">
    <h2>âœˆï¸ Create Account</h2>
    <?= $msg ?>
    <form method="POST">
      <input type="text" name="username" class="form-control mb-3" placeholder="Username" required>
      <input type="email" name="email" class="form-control mb-3" placeholder="Email" required>
      <input type="password" name="password" class="form-control mb-3" placeholder="Password" required>
      <button type="submit" class="btn btn-primary w-100">Sign Up</button>
    </form>
    <p class="mt-3 text-center">Already have an account? <a href="login.php">Login</a></p>
  </div>
</body>
</html>
--------------------------------------------------------
--- END OF FILE: signup.php ---

--- START OF FILE: style.css ---
--------------------------------------------------------
/* =======================
   Global Body
======================= */
body {
  background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
  font-family: 'Segoe UI', sans-serif;
  min-height: 100vh;
  margin: 0;
  padding: 0;
  color: #333;
}

/* =======================
   Navbar Links
======================= */
.nav-link:hover {
  background-color: #0d6efd;
  color: #fff !important;
  border-radius: 8px;
  transition: 0.3s;
}

/* =======================
   Cards
======================= */
.card {
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  transition: 0.3s;
}
.card:hover {
  transform: translateY(-3px);
}

/* =======================
   CRUD Panel Headings
======================= */
.crud-panel h4 {
  margin-right: 15px;
  color: #333;
}

/* =======================
   Tables
======================= */
.table {
  background-color: rgba(255, 255, 255, 0.95);
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.table th {
  background: #667eea;
  color: white;
}
.table tr:nth-child(even) {
  background: rgba(102, 126, 234, 0.1);
}

/* =======================
   Buttons
======================= */
.btn-primary {
  background: linear-gradient(to right, #667eea, #764ba2);
  border: none;
  color: white;
  transition: 0.3s;
}
.btn-primary:hover {
  opacity: 0.9;
}

.btn-success {
  background: linear-gradient(to right, #43e97b, #38f9d7);
  border: none;
  color: white;
  transition: 0.3s;
}
.btn-success:hover {
  opacity: 0.9;
}

/* =======================
   Chat Container
======================= */
.chat-container {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  height: 70vh;
}

.assistant-message {
  background: linear-gradient(to right, #e0eafc, #cfdef3);
  color: #333;
  border-radius: 15px;
  padding: 8px 12px;
  margin-bottom: 10px;
  max-width: 80%;
}

.user-message {
  background: linear-gradient(to right, #667eea, #764ba2);
  color: white;
  border-radius: 15px;
  padding: 8px 12px;
  margin-bottom: 10px;
  max-width: 80%;
  margin-left: auto;
}
/* =======================
   Animated Airplane
======================= */
.airplane {
  position: fixed;
  width: 80px;
  top: 20%;
  left: -100px; /* Start off-screen */
  z-index: 1000;
  animation: fly 15s linear infinite;
}

@keyframes fly {
  0% {
    transform: translateX(0) rotate(0deg);
  }
  50% {
    transform: translateX(120vw) rotate(15deg); /* Fly across the screen */
  }
  100% {
    transform: translateX(-10vw) rotate(0deg); /* Loop back */
  }
}
--------------------------------------------------------
--- END OF FILE: style.css ---

--- START OF FILE: sum.java ---
--------------------------------------------------------
import java.util.Scanner
public class Sum
{
  public static void main(String[] args)
 {
	Scanner input =new Scanner(System.in);
	int num1=input.nextInt();
	int num2=input.nextInt();
	int sum=num1+num2;
	System.out.println("Sum=" +sum);
--------------------------------------------------------
--- END OF FILE: sum.java ---

--- START OF FILE: test_api.php ---
--------------------------------------------------------
<?php
$key = "YOUR_GEMINI_API_KEY";
$url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=$key";

$payload = json_encode(["contents" => [[ "parts" => [["text" => "Hello Gemini"]] ]]]);
$ch = curl_init($url);
curl_setopt_array($ch, [
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_POST => true,
    CURLOPT_HTTPHEADER => ["Content-Type: application/json"],
    CURLOPT_POSTFIELDS => $payload,
]);
echo curl_exec($ch);
curl_close($ch);
?>
--------------------------------------------------------
--- END OF FILE: test_api.php ---

--- START OF FILE: Untitled.txt ---
--------------------------------------------------------

Setting environment for using XAMPP for Windows.
ganes_kxvl8b7@MAHESH c:\xampp
# mysql -u root
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 10
Server version: 10.4.32-MariaDB mariadb.org binary distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| airline            |
| airline_project    |
| information_schema |
| library_db         |
| movie_db           |
| mysql              |
| performance_schema |
| phpmyadmin         |
| test               |
+--------------------+
9 rows in set (0.056 sec)

MariaDB [(none)]> use airline;
Database changed
MariaDB [airline]> show tables;
+-------------------+
| Tables_in_airline |
+-------------------+
| airplane          |
| airplane_type     |
| airport           |
| can_land          |
| fare              |
| flight            |
| flight_leg        |
| leg_instance      |
| reservation       |
| seat              |
+-------------------+
10 rows in set (0.001 sec)

MariaDB [airline]> SELECT Seat_no, COUNT(*) AS total_bookings
    -> FROM Reservation
    -> GROUP BY Seat_no
    -> ORDER BY total_bookings DESC
    -> LIMIT 1;
+---------+----------------+
| Seat_no | total_bookings |
+---------+----------------+
| 14C     |              3 |
+---------+----------------+
1 row in set (0.001 sec)

MariaDB [airline]> SELECT Flight_number, Date, COUNT(*) AS total_reservations
    -> FROM Reservation
    -> GROUP BY Flight_number, Date
    -> HAVING COUNT(*) > 1;
Empty set (0.002 sec)

MariaDB [airline]> SELECT Customer_name, Seat_no, COUNT(DISTINCT Flight_number) AS flights_with_same_seat
    -> FROM Reservation
    -> GROUP BY Customer_name, Seat_no
    -> HAVING COUNT(DISTINCT Flight_number) > 1;
+---------------+---------+------------------------+
| Customer_name | Seat_no | flights_with_same_seat |
+---------------+---------+------------------------+
| MAHES         | 14C     |                      3 |
+---------------+---------+------------------------+
1 row in set (0.001 sec)

MariaDB [airline]> SELECT Flight_number, Leg_no, Date, Seat_no, Customer_name, COUNT(*) AS duplicates
    -> FROM Reservation
    -> GROUP BY Flight_number, Leg_no, Date, Seat_no, Customer_name
    -> HAVING COUNT(*) > 1;
Empty set (0.001 sec)

MariaDB [airline]> SELECT A.Type_name, COUNT(*) AS total_reservations
    -> FROM Reservation R
    -> JOIN Airplane A ON R.Airplane_id = A.Airplane_id
    -> GROUP BY A.Type_name
    -> ORDER BY total_reservations DESC;
+-------------+--------------------+
| Type_name   | total_reservations |
+-------------+--------------------+
| Airbus-A320 |                  5 |
+-------------+--------------------+
1 row in set (0.011 sec)

MariaDB [airline]>
--------------------------------------------------------
--- END OF FILE: Untitled.txt ---

--- START OF FILE: update_cell.php ---
--------------------------------------------------------
<?php
include 'db.php';

if (!isset($_POST['table'], $_POST['column'], $_POST['newValue'], $_POST['pkCol'], $_POST['pkVal'])) {
    echo "missing parameters";
    exit;
}

$table = $_POST['table'];
$column = $_POST['column'];
$newValue = $_POST['newValue'];
$pkCol = $_POST['pkCol'];
$pkVal = $_POST['pkVal'];

// Escape identifiers safely
$table = preg_replace('/[^a-zA-Z0-9_]/', '', $table);
$column = preg_replace('/[^a-zA-Z0-9_]/', '', $column);
$pkCol = preg_replace('/[^a-zA-Z0-9_]/', '', $pkCol);

// Prepare dynamic update query safely
$stmt = $conn->prepare("UPDATE `$table` SET `$column` = ? WHERE `$pkCol` = ?");
if(!$stmt){
    echo "prepare error: " . $conn->error;
    exit;
}
$stmt->bind_param("ss", $newValue, $pkVal);

if ($stmt->execute()) {
    echo "success";
} else {
    echo "error: " . $conn->error;
}
$stmt->close();
?>
--------------------------------------------------------
--- END OF FILE: update_cell.php ---

--- START OF FILE: view_reservations.php ---
--------------------------------------------------------
<?php include 'header.php'; ?>

<?php
include 'db.php';
$result = $conn->query("SELECT * FROM Reservation");
?>
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css">

    <title>View Reservations</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
    <h2>ðŸ“‹ Current Reservations</h2>

    <?php if (isset($_GET['status']) && $_GET['status'] == 'deleted'): ?>
        <div class="alert alert-success">âœ… Reservation cancelled successfully!</div>
    <?php elseif (isset($_GET['status']) && $_GET['status'] == 'error'): ?>
        <div class="alert alert-danger">âŒ Cancellation failed. Please try again.</div>
    <?php endif; ?>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Flight</th>
                <th>Leg</th>
                <th>Date</th>
                <th>Airplane</th>
                <th>Seat</th>
                <th>Name</th>
                <th>Phone</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <?php
            if ($result->num_rows > 0) {
                while ($row = $result->fetch_assoc()) {
                    echo "<tr>
                        <td>{$row['Flight_number']}</td>
                        <td>{$row['Leg_no']}</td>
                        <td>{$row['Date']}</td>
                        <td>{$row['Airplane_id']}</td>
                        <td>{$row['Seat_no']}</td>
                        <td>{$row['Customer_name']}</td>
                        <td>{$row['Cphone']}</td>
                        <td>
                            <form method='POST' action='cancel_reservation.php'>
                                <input type='hidden' name='flight_number' value='{$row['Flight_number']}'>
                                <input type='hidden' name='leg_no' value='{$row['Leg_no']}'>
                                <input type='hidden' name='date' value='{$row['Date']}'>
                                <input type='hidden' name='seat_no' value='{$row['Seat_no']}'>
                                <button type='submit' class='btn btn-danger btn-sm'>Cancel</button>
                            </form>
                        </td>
                    </tr>";
                }
            } else {
                echo "<tr><td colspan='8'>No reservations found.</td></tr>";
            }
            ?>
        </tbody>
    </table>

    <a href="make_reservation.php" class="btn btn-primary">Make Another Reservation</a>

</body>
</html>
--------------------------------------------------------
--- END OF FILE: view_reservations.php ---

